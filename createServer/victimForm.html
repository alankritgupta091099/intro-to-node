<html>
    <head>
        <title>
            FirstWebForm
        </title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    </head>
    <body>
        <div class="container">    
            <h1  id="test">Enter Your Information</h1>
            <div class="jumbotron ">
                <form id="inputForm">
                    <h3>Information</h3><br>
                    <div class="form-group">
                        <label >Name: </label>
                        <input type="text" name='name' id='name' placeholder="Enter username" class="form-control "></input>
                    </div>
                    <div class="form-group">
                        <label >Number of people with you: </label>
                        <input type="number" id="people" name='people' placeholder="Enter number of people with you" class="form-control "></input>
                    </div>
                    <div class="form-group">
                        <label >Contact Number: </label>
                        <input type="number" id="mobileNumber" name='mobileNumber' placeholder="Enter contact number" class="form-control "></input>
                    </div>
                    <label >Your location: </label><br>
                    <div class="row">
                        <div class="form-group col-lg-6">
                            <button type="button" class="btn" onclick="getLocation()">Get Location</button>
                        </div>
                        <div class="form-group col-lg-6">
                            <div id="position"></div>
                        </div>
                    </div>
                    <button type ="submit" class="btn btn-primary" >Submit</button>
                </form>
            </div>
        </div>
        <script src="https://www.gstatic.com/firebasejs/5.8.4/firebase.js"></script>
        <script>
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyAqdcKkj7n_HRkI513VPG0F6VxqykGDOS4",
                authDomain: "sih2019-f0d6c.firebaseapp.com",
                databaseURL: "https://sih2019-f0d6c.firebaseio.com",
                projectId: "sih2019-f0d6c",
                storageBucket: "sih2019-f0d6c.appspot.com",
                messagingSenderId: "209332515266"
            };  firebase.initializeApp(config);

            
            var ref= firebase.database().ref('latLong');
            ref.on("value",getdata);

            function getdata(data){
                console.log(data.val());
            }

            //referance message collection
            var messagesRef=firebase.database().ref('people affected');

            //listen to submit
            document.getElementById('inputForm').addEventListener('submit',submitForm);

            //get values
            function submitForm(e){
                e.preventDefault();

                var name=getInputVal('name');
                var people=getInputVal('people');
                var mobileNumber=getInputVal('mobileNumber');
                getLocation();
                var position= x.innerHTML;
                console.log(position);
                saveMessage(name,people,mobileNumber,position);
                alert("We have your location, we'll reach to you ASAP");
            }
            var x = document.getElementById("position");
            //save function to get values
            function getInputVal(id){
                return document.getElementById(id).value;
            }
            function getLocation() {
                if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
                } else { 
                x.innerHTML = "Geolocation is not supported by this browser.";
                }
            }
            function showPosition(position) {
                x.innerText="Latitude: " + position.coords.latitude + " Longitude: " + position.coords.longitude;
                //return position.coords.latitude; //+ " Longitude: " + position.coords.longitude;
            }

            //save message to firebase

            function saveMessage(name,people,mobileNumber,position)
            {
                var newMessageRef = messagesRef.push();
                newMessageRef.set({
                    "name":name,
                    "noOfPeople":people,
                    "mobilenumber":mobileNumber,
                    "position":position
                });
            }
        </script>
    </body>
</html>